<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Banking App — Observer / Strategy / Command (Demo)</title>
  <style>
    :root{ --bg:#f5f7fb; --card:#fff; --muted:#6b7280; --accent:#2563eb; --danger:#dc2626; }
    body{ font-family: Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial; background:var(--bg); margin:0; padding:24px; color:#111827; }
    .wrap{ max-width:1000px; margin:0 auto; display:grid; grid-template-columns: 1fr 360px; gap:20px; }
    .card{ background:var(--card); border-radius:12px; padding:18px; box-shadow:0 6px 18px rgba(16,24,40,0.06); }
    h2{ margin:0 0 12px 0; font-size:18px; }
    .account{ display:flex; align-items:center; justify-content:space-between; padding:10px 8px; border-radius:8px; border:1px solid #eef2ff; margin-bottom:10px; }
    .meta{ display:flex; gap:12px; align-items:center; }
    .badge{ background:#eef2ff; color:var(--accent); padding:6px 8px; border-radius:8px; font-weight:600; font-size:12px; }
    label{ display:block; font-size:13px; color:var(--muted); margin-top:8px; }
    input[type="number"], input[type="text"], select{ width:100%; padding:8px 10px; border-radius:8px; border:1px solid #e6e9ef; margin-top:6px; box-sizing:border-box; }
    button{ background:var(--accent); color:#fff; border:0; padding:8px 12px; border-radius:8px; cursor:pointer; font-weight:600; }
    button.ghost{ background:transparent; color:var(--accent); border:1px solid rgba(37,99,235,0.12); }
    .muted{ color:var(--muted); font-size:13px; }
    .list{ max-height:300px; overflow:auto; padding-right:6px; }
    .controls{ display:flex; gap:8px; margin-top:10px; }
    .notifications{ max-height:420px; overflow:auto; display:flex; flex-direction:column; gap:10px; }
    .note{ padding:10px; border-radius:8px; border-left:4px solid rgba(99,102,241,0.16); background:#fbfdff; font-size:14px; }
    .small{ font-size:12px; color:var(--muted); }
    .actions{ display:flex; gap:6px; }
    .danger{ background:var(--danger); }
    footer{ margin-top:14px; font-size:12px; color:var(--muted); }
    .row{ display:flex; gap:8px; }
    .flex-col{ display:flex; flex-direction:column; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h2>Accounts & Transactions — Demo UI</h2>
      <p class="muted">This demo implements Observer (notifications), Strategy (interest calc), and Command (operations + undo) in plain JavaScript. Use the controls below.</p>

      <div style="margin-top:12px; display:flex; gap:12px;">
        <div style="flex:1">
          <label>Create account</label>
          <input id="newName" placeholder="Account name (e.g. Savings)" />
          <label>Type</label>
          <select id="newType"><option value="savings">Savings</option><option value="fixed">Fixed Deposit</option><option value="current">Current</option></select>
          <label>Initial balance</label>
          <input id="newBalance" type="number" value="1000" />
          <div class="controls">
            <button id="createBtn">Create</button>
            <button id="seedBtn" class="ghost">Seed demo</button>
          </div>
        </div>

        <div style="width:260px">
          <label>Selected account</label>
          <div id="selectedCard" class="card" style="padding:12px;">
            <div id="selName" style="font-weight:700">—</div>
            <div class="small" id="selType">—</div>
            <div style="margin-top:8px;font-size:18px" id="selBalance">₹ 0.00</div>
          </div>

          <label style="margin-top:8px">Operations</label>
          <input id="amt" type="number" placeholder="Amount" />
          <div class="controls" style="margin-top:8px">
            <button id="depositBtn">Deposit</button>
            <button id="withdrawBtn" class="ghost">Withdraw</button>
          </div>
          <label style="margin-top:8px">Transfer to</label>
          <select id="transferTo"></select>
          <div class="controls" style="margin-top:8px">
            <button id="transferBtn">Transfer</button>
            <button id="undoBtn" class="ghost">Undo last</button>
          </div>
        </div>
      </div>

      <hr style="margin:14px 0; border:none; border-top:1px solid #eef2ff" />

      <div style="display:flex; gap:12px">
        <div style="flex:1">
          <h3 style="margin:0 0 8px 0; font-size:15px">Accounts</h3>
          <div id="accounts" class="list"></div>
        </div>
        <div style="width:300px">
          <h3 style="margin:0 0 8px 0; font-size:15px">Transaction log</h3>
          <div id="log" class="list small"></div>
        </div>
      </div>

      <footer>Tip: this is a front-end mock — no server. Balances and history reset on page reload.</footer>
    </div>

    <div class="card">
      <h2>Notifications</h2>
      <p class="muted">Observers receive account updates. Notifications show events from deposits, withdrawals, transfers, and undo actions.</p>
      <div id="notifications" class="notifications" style="margin-top:12px"></div>

      <hr style="margin:12px 0; border:none; border-top:1px solid #eef2ff" />
      <h3 style="margin:6px 0">Interest demo</h3>
      <div class="small">Pick an account and click "Apply interest" to run its InterestStrategy for 30 days (demo).</div>
      <div style="margin-top:8px">
        <button id="interestBtn" class="ghost">Apply interest (30 days)</button>
      </div>
    </div>
  </div>

<script>
// -----------------------
// Domain + Patterns (JS)
// -----------------------

// Observer: account subject + observer interface
class AccountEvent {
  constructor(accountId, oldBalance, newBalance, reason){
    this.accountId = accountId; this.oldBalance = oldBalance; this.newBalance = newBalance; this.reason = reason;
  }
}

class Account {
  constructor(id, name, type, initial, interestStrategy){
    this.id = id; this.name = name; this.type = type; this.balance = initial || 0; this.strategy = interestStrategy;
    this.observers = [];
  }
  attach(obs){ this.observers.push(obs); }
  detach(obs){ this.observers = this.observers.filter(o => o !== obs); }
  notify(ev){ this.observers.forEach(o => o.update && o.update(ev)); }

  deposit(amount, reason = 'deposit'){
    const old = this.balance; this.balance += amount; this.notify(new AccountEvent(this.id, old, this.balance, reason));
  }
  withdraw(amount, reason = 'withdraw'){
    if (amount > this.balance) return false;
    const old = this.balance; this.balance -= amount; this.notify(new AccountEvent(this.id, old, this.balance, reason));
    return true;
  }
}

// Interest Strategy
class InterestStrategy { calculate(balance, days){ return 0; } }
class SavingsInterest extends InterestStrategy{ calculate(b,d){ return b * 0.04 * (d/365); } }
class FixedInterest extends InterestStrategy{ calculate(b,d){ return b * 0.06 * (d/365); } }
class CurrentInterest extends InterestStrategy{ calculate(b,d){ return 0; } }

// Observers: Notification center and Audit logger
class NotificationCenter {
  constructor(element){ this.el = element; }
  update(ev){
    const div = document.createElement('div'); div.className = 'note';
    div.textContent = `[${new Date().toLocaleTimeString()}] ${ev.reason} — ${ev.accountId}: ₹ ${ev.oldBalance.toFixed(2)} → ₹ ${ev.newBalance.toFixed(2)}`;
    this.el.prepend(div);
  }
}

class AuditLogger {
  constructor(logEl){ this.el = logEl; }
  update(ev){
    const row = document.createElement('div'); row.textContent = `${new Date().toLocaleTimeString()} | ${ev.accountId} | ${ev.reason} | ${ev.oldBalance.toFixed(2)} -> ${ev.newBalance.toFixed(2)}`;
    this.el.prepend(row);
  }
}

// Command Pattern: base + concrete commands
class Command {
  execute(){ throw 'implement'; }
  undo(){ throw 'implement'; }
}
class DepositCommand extends Command {
  constructor(account, amount){ super(); this.acct = account; this.amount = amount; }
  execute(){ this.acct.deposit(this.amount, 'deposit'); return true; }
  undo(){ this.acct.withdraw(this.amount, 'undo-deposit'); }
}
class WithdrawCommand extends Command {
  constructor(account, amount){ super(); this.acct = account; this.amount = amount; this.succeeded = false; }
  execute(){ this.succeeded = this.acct.withdraw(this.amount, 'withdraw'); return this.succeeded; }
  undo(){ if (this.succeeded) this.acct.deposit(this.amount, 'undo-withdraw'); }
}
class TransferCommand extends Command {
  constructor(from, to, amount){ super(); this.from = from; this.to = to; this.amount = amount; this.succeeded = false; }
  execute(){
    if (!this.from.withdraw(this.amount, 'transfer-out')) return false;
    this.to.deposit(this.amount, 'transfer-in'); this.succeeded = true; return true;
  }
  undo(){ if (!this.succeeded) return; this.to.withdraw(this.amount, 'undo-transfer-in'); this.from.deposit(this.amount, 'undo-transfer-out'); }
}

class TransactionManager {
  constructor(){ this.history = []; }
  execute(cmd){ const ok = cmd.execute(); if (ok) this.history.push(cmd); return ok; }
  undoLast(){ const cmd = this.history.pop(); if (cmd) cmd.undo(); }
}

// -----------------------
// UI glue
// -----------------------
const accountsEl = document.getElementById('accounts');
const notificationsEl = document.getElementById('notifications');
const logEl = document.getElementById('log');
const transferTo = document.getElementById('transferTo');
const selName = document.getElementById('selName');
const selType = document.getElementById('selType');
const selBalance = document.getElementById('selBalance');

const notifCenter = new NotificationCenter(notificationsEl);
const audit = new AuditLogger(logEl);
const tx = new TransactionManager();

let accounts = [];
let selected = null;
let idCounter = 1;

function makeStrategy(type){ if (type==='savings') return new SavingsInterest(); if (type==='fixed') return new FixedInterest(); return new CurrentInterest(); }

function createAccount(name, type, init){ const id = `AC${idCounter++}`; const acct = new Account(id, name, type, init, makeStrategy(type)); acct.attach(notifCenter); acct.attach(audit); accounts.push(acct); renderAccounts(); selectAccount(acct.id); return acct; }

function renderAccounts(){ accountsEl.innerHTML=''; transferTo.innerHTML='';
  accounts.forEach(a=>{
    const div = document.createElement('div'); div.className='account';
    div.innerHTML = `<div class='meta'><div style='font-weight:700'>${a.name}</div><div class='badge'>${a.type}</div></div><div style='text-align:right'><div>₹ ${a.balance.toFixed(2)}</div><div class='small'>id: ${a.id}</div></div>`;
    div.onclick = ()=> selectAccount(a.id);
    accountsEl.appendChild(div);

    const opt = document.createElement('option'); opt.value = a.id; opt.text = `${a.name} (${a.id})`; transferTo.appendChild(opt);
  });
  updateSelectedCard();
}

function selectAccount(id){ selected = accounts.find(a=>a.id===id); updateSelectedCard(); }

function updateSelectedCard(){ if (!selected){ selName.textContent='—'; selType.textContent='—'; selBalance.textContent='₹ 0.00'; return; }
  selName.textContent = `${selected.name} (${selected.id})`;
  selType.textContent = `${selected.type}`;
  selBalance.textContent = `₹ ${selected.balance.toFixed(2)}`;
}

// UI events
document.getElementById('createBtn').onclick = ()=>{
  const name = document.getElementById('newName').value || (`Account ${idCounter}`);
  const type = document.getElementById('newType').value;
  const bal = parseFloat(document.getElementById('newBalance').value)||0;
  createAccount(name, type, bal);
};

document.getElementById('seedBtn').onclick = ()=>{
  createAccount('Savings', 'savings', 1500);
  createAccount('Salary', 'current', 600);
  createAccount('FD-1yr', 'fixed', 10000);
};

document.getElementById('depositBtn').onclick = ()=>{
  const amt = parseFloat(document.getElementById('amt').value)||0; if (!selected) return alert('Select an account');
  const cmd = new DepositCommand(selected, amt);
  const ok = tx.execute(cmd);
  if (!ok) alert('Deposit failed'); renderAccounts();
};

document.getElementById('withdrawBtn').onclick = ()=>{
  const amt = parseFloat(document.getElementById('amt').value)||0; if (!selected) return alert('Select an account');
  const cmd = new WithdrawCommand(selected, amt);
  const ok = tx.execute(cmd);
  if (!ok) alert('Insufficient funds'); renderAccounts();
};

document.getElementById('transferBtn').onclick = ()=>{
  const amt = parseFloat(document.getElementById('amt').value)||0; if (!selected) return alert('Select a "from" account');
  const toId = transferTo.value; if (!toId) return alert('Select a "to" account');
  if (toId === selected.id) return alert('Choose a different destination');
  const to = accounts.find(a=>a.id===toId);
  const cmd = new TransferCommand(selected, to, amt);
  const ok = tx.execute(cmd);
  if (!ok) alert('Transfer failed (insufficient funds)'); renderAccounts();
};

document.getElementById('undoBtn').onclick = ()=>{ tx.undoLast(); renderAccounts(); };

document.getElementById('interestBtn').onclick = ()=>{
  if (!selected) return alert('Select an account');
  const interest = selected.strategy.calculate(selected.balance, 30);
  if (interest <= 0) return alert('No interest for this account');
  const cmd = new DepositCommand(selected, parseFloat(interest.toFixed(2)));
  tx.execute(cmd);
  renderAccounts();
};

// initial render
renderAccounts();

</script>
</body>
</html>
